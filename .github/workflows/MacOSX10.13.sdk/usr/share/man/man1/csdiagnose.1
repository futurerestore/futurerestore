.\"Modified from man(1) of FreeBSD, the NetBSD mdoc.template, and mdoc.samples.
.\"See Also:
.\"man mdoc.samples for a complete listing of options
.\"man mdoc for the short list of editing options
.\"/usr/share/misc/mdoc.template
.Dd 4/21/2014               \" DATE 
.Dt csdiagnose 1      \" Program name and manual section number 
.Os OS X
.Sh NAME                 \" Section Header - required - don't modify 
.Nm csdiagnose
.Nd collect information needed to diagnose CoreStorage volumes
.Sh SYNOPSIS             \" Section Header - required - don't modify
.Nm
.Op Fl f Ar path
.Op Fl h
.Op Fl v
.Op Ar dev ...
.Sh DESCRIPTION          \" Section Header - required - don't modify
.Nm
collects information to help Apple investigate issues related to CoreStorage (File Vault 2, Fusion Drive, File Vault Everywhere, etc).  This tool invokes sudo, so you will be asked to authenticate.
.Pp
This script requires
.Xr csgather 1
to be installed in the PATH.
.Pp
If
.Ar dev
is not given, all disks in the system will be inspected.  This is the recommended method of invoking
.Nm .
.Pp
Advanced users can provide a list of
.Ar dev
in the form of
.Pa disk1
or
.Pa disk1s2 .
Only information of the given
.Ar dev
is collected.  To fully collect information of a CoreStorage volume, the CoreStorage Physical Volume (i.e., the Apple_CoreStorage partition), the Apple_Boot partition after the physical volume, and the Logical Volume published by CoreStorage (which can be found out using the
.Qq diskutil cs list
command) should all be provided on the command line.
.Pp
The following information is collected:
.Bl -enum -offset indent
.It
OS version.
.It
system logs, kernel logs, install logs, filesystem logs, and other useful information for CoreStorage debugging from
.Pa /var/log .
.It
output of
.Qq diskutil list .
.It
output of
.Qq diskutil cs list .
.It
output of
.Qq mount -t hfs .
.It
.Qq csgather -G
of every Apple_CoreStorage partition, which includes the CoreStorage metadata.  If a list of
.Ar dev
is provided, only information on the partitions included in the list will be collected.
.It
.Pa EncryptedRoot.plist
of every Apple_Boot partition.  If a list of
.Ar dev
is provided, only information on the partitions included in the list will be collected.
.It
timestamps of the files relevant to kextcache/kextd.
.El
.Pp
The following user information is contained in the collected file:
.Pp
.Bl -enum -offset indent
.It
Number and types of disks attached to the system.
.It
The volume names, UUIDs, and size of each partition.
.It
Encrypted versions of the volume key(s) that unlock the encrypted disk(s) attached to the system.  Refer to
.Xr csgather 1
for what information could leak from the volume key(s).
.It
User names, pictures, and password hints for the users.
.El
.Pp
No other user information (such as directory structures, file names,
file content, etc) is collected.
.Pp
The following options are available:
.Bl -tag -width ".It Fl f Ar path"
.It Fl h
Show this help information.
.It Fl f Ar path
Specify an output path which will hold the file generated by this script.  By default this will be the user's Desktop folder.  The given path must already exist.
.It Fl v
Verbose mode, which prints every command it invokes.
.El
.Pp
.Sh SEE ALSO
.Xr csgather 1 ,
.Xr sysdiagnose 1
.Sh HISTORY
The
.Nm
utility first appeared along with CoreStorage in OS X 10.10.0.
